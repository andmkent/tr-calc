\documentclass{article}
\usepackage{xspace}
\usepackage{amssymb}
\usepackage{amsmath}
\usepackage{amsfonts}
\usepackage{amsthm}
%\usepackage{mathabx}
\usepackage{mathpartir}
\usepackage[margin=0.5in]{geometry}

\usepackage{bbm}
\makeatletter
\newcommand{\ctx}{\ensuremath{\mathsf{ctx}}}
\newcommand{\define}[1]{\textbf{#1}}
\newcommand{\indexdef}[1]{\index{#1|defstyle}}   
\newcommand{\indexsee}[2]{\index{#1|see{#2}}}    
\newcommand{\intro}{\textsc{intro}}
\def\lamu#1{{\lambda}\@lamuarg#1:\@endlamuarg\@ifnextchar\bgroup{.\,\lamu}{.\,}}
\def\@lamuarg#1:#2\@endlamuarg{#1}
\newcommand{\Subst}{\mathsf{Subst}}
\newcommand{\tmtp}[2]{#1 \mathord{:} #2}
\def\tprd#1{\@tprd{#1}\@ifnextchar\bgroup{\tprd}{}}
\def\@tprd#1{\mathchoice{{\textstyle\prod_{(#1)}}}{\prod_{(#1)}}{\prod_{(#1)}}{\prod_{(#1)}}}
\newcommand{\UU}{\ensuremath{\mathcal{U}}\xspace}
\newcommand{\Vble}{\mathsf{Vble}}
\newcommand{\Weak}{\mathsf{Wkg}}
\newcommand{\wfctx}[1]{#1\ \ctx}
\makeatother

\newcommand{\Ttype}{\mathbf{T}}
\newcommand{\Ftype}{\mathbf{F}}
\newcommand{\Tval}{\# \textrm{t}}
\newcommand{\Fval}{\# \textrm{f}}
\newcommand{\Tprop}{\mathbb{T}}
\newcommand{\Fprop}{\mathbb{F}}
\newcommand{\Uprop}{\mathbb{U}}
\newcommand{\Ntype}{\mathbf{N}}
\newcommand{\Btype}{\mathbf{B}}
\newcommand{\NOT}{\overline}
\newcommand{\TypeOf}[5]{#1 \vdash #2 : #3 \: ; \: #4 \: ; \: #5}
\newcommand{\Proves}[2]{#1 \vdash #2}
\newcommand{\listof}{\overrightarrow}
\newcommand{\lvec}{[[}
\newcommand{\rvec}{]]}
\newcommand{\funtype}[5]{#1\mathord{:}#2 \xrightarrow[ #4 ]{ #3 } #5 }
\newcommand{\deptype}[1]{\{ \diamond : \Ntype \: | \: #1 \}}
\newcommand{\pairtype}[2]{\langle #1 , #2 \rangle}
\newcommand{\U}{\bigcup}
\newcommand{\NullO}{\emptyset}

\begin{document}
\index{structural!rules|(}%
\index{rule!structural|(}%

\begin{figure}
\begin{tabular}{r  l  l}

$e  ::= $ & $ x \mid 
	            (e \: e) \mid  
	            \lambda x^{\tau}.e \mid 
	            (\mathbf{if} \: e \: e \: e) \mid
	            c \mid
	            \Tval \mid
	            \Fval \mid
	             (cons \: e \: e) \mid
	             (vec \: \listof{e}) \mid
	            n $ & Expressions \\
$c  ::= $ & $ 
	add1 \mid 
	\: =_n \: \mid  
	\: \leq_n \: \mid  
	num? \mid 
	 bool? \mid
	 proc? \mid
	 cons? \mid
	 vec? \mid
	 car \mid
	 cdr \mid
	 len \mid
     ref_n $ & Primitive Operations \\
$ pe ::= $ & $ 
	\mathbf{car} \mid 
	\mathbf{cdr} \mid
	\mathbf{ref}_n \mid
	\mathbf{len} $ & Path Elements \\
$ \pi ::= $ & $ 
	\listof{pe} $ & Paths \\
$ o ::= $ & $ 
	\NullO \mid 
    \pi (x) $ & Objects \\
$ \phi ::= $ & $ 
	a_{1} o_{1} + ... + a_{(i-1)}
    \leq a_{i}o_{i} + ... + a_j $ & Linear Inequalities \\
$ \Phi ::= $ & $ 
	\listof{\phi} $ & System of Linear Inequalities \\
$\sigma , \tau  ::= $ & $ 
	\top \mid
    \Ntype \mid 
	\deptype{\Phi} \mid
	\Ttype \mid
	\Ftype  \mid
	(\U \listof{\tau}) \mid
	\pairtype{\tau}{\tau} \mid
	\lvec \listof{\tau} \rvec \mid
	\funtype{x}{\sigma}{\psi}{o}{\tau} $ & Types \\
$\psi ::= $ & $ 
	\tau_{\pi(x)} \mid 
	\NOT{\tau}_{\pi(x)} \mid  
	\psi \supset \psi \mid 
	\psi \wedge \psi \mid 
	\psi \vee \psi \mid
    \Phi \mid
	\Tprop \mid
	\Fprop \mid
    \Uprop $ & Propositions \\
$ \Gamma ::= $ & $ 
	\listof{\psi} $ & Environments \\	
\end{tabular}
\caption{Syntax of Types, Propositions, Terms, etc...}
\end{figure}


% Typing Rules
\begin{figure}
\begin{mathpar}
  \inferrule[T-Num]
  {}{\TypeOf{\Gamma}{n}{\deptype{\diamond = n}}{\Tprop}{\NullO}}

\and
  \inferrule[T-Const]
  {}{\TypeOf{\Gamma}{c}{\delta_{\tau}(c)}{\Tprop}{\NullO}}

\and
  \inferrule[T-True]
  {}{\TypeOf{\Gamma}{\Tval}{\Ttype}{\Tprop}{\NullO}}

\and
  \inferrule[T-False]
  {}{\TypeOf{\Gamma}{\Fval}{\Ftype}{\Fprop}{\NullO}}

\and
  \inferrule[T-Var]
  {\Proves{\Gamma}{\tau_{x}}}
  {\TypeOf{\Gamma}{x}{\tau}{\NOT{\Ftype}_x}{x}}

\and
  \inferrule[T-Abs]
  {\TypeOf{\Gamma, \sigma_x}{e}{\tau}{\psi}{o}}
  {\TypeOf{\Gamma}{\lambda x^\sigma . e}{\funtype{x}{\sigma}{\psi}{o}{\tau}}{\Tprop}{\NullO}}


\and
  \inferrule[T-App]
  {\TypeOf{\Gamma}{e}{\funtype{x}{\sigma}{\psi_{f}}{o_f}{\tau}}{\psi}{o} \\\\
    \TypeOf{\Gamma}{e'}{\sigma}{\psi'}{o'}}
  {\TypeOf{\Gamma} {(e \: e')}{\tau [o' / x]}{\psi_{f}[o' / x]}{o_f[o' / x]}}


\and
  \inferrule[T-If]
  {\TypeOf{\Gamma}{e_1}{\tau_1}{\psi_{1}}{o_1} \\\\
    \TypeOf{\Gamma}{e_2}{\tau}{\psi_{2}}{o} \\\\
    \TypeOf{\Gamma}{e_3}{\tau}{\psi_{3}}{o}}
  {\TypeOf{\Gamma}{(\mathbf{if} \: e_1 \: e_2 \: e_3)}{ \tau}{\psi_{2} \vee \psi_{3}}{o}}

\and
  \inferrule[T-Let]
  {\TypeOf{\Gamma}{e_0}{\tau}{\psi_{0}}{o_0} \\\\
    \TypeOf{\Gamma, \tau_x, \NOT{\Ftype}_x \supset \psi_{0}, \Ftype_x \supset \neg\psi_{0}}{e_1}{\sigma}{\psi_{1}}{o_1}}
  {\TypeOf{\Gamma}{(\mathbf{let} \: (x \: e_0) \: e_1)}{\sigma [o_0 / x]}{\psi_{1}[o_0 / x]} {o_1 [o_0 / x]}}


\and
  \inferrule[T-Cons]
  {\TypeOf{\Gamma}{e_1}{\tau_1}{\psi_{1}}{o_1} \\\\
    \TypeOf{\Gamma}{e_2}{\tau_2}{\psi_{2}}{o_2}}
  {\TypeOf{\Gamma}{(cons \: e_1 \: e_2)}{\pairtype{\tau_1}{\tau_2}}{\Tprop}{\NullO}}

\and
  \inferrule[T-Car]
  {\TypeOf{\Gamma}{e}{\pairtype{\tau_1}{\tau_2}}{\psi}{o}}
  {\TypeOf{\Gamma}{(car \: e)}{\tau_1}{\NOT{\Ftype}_{\mathbf{car}(x)}[o / x]}{\mathbf{car}(x) [o / x]}}

\and
  \inferrule[T-Cdr]
  {\TypeOf{\Gamma}{e}{\pairtype{\tau_1}{\tau_2}}{\psi}{o}}
  {\TypeOf{\Gamma}{(cdr \: e)}{\tau_2}{\NOT{\Ftype}_{\mathbf{cdr}(x)}[o / x]}{\mathbf{cdr}(x) [o / x]}}

\and
  \inferrule[T-Vec]
  {\TypeOf{\Gamma}{e_1}{\tau_1}{\psi_{1}}{o_1} \\\\
    \dots \\\\
    \TypeOf{\Gamma}{e_n}{\tau_n}{\psi_{n}}{o_n}}
  {\TypeOf{\Gamma}{(vec \: e_1 \: \dots \: e_n)}{ \lvec \tau_1 \: \dots \: \tau_n \rvec}{\Tprop}{\NullO}}

\and
  \inferrule[T-Ref]
  {\TypeOf{\Gamma}{e}{\lvec \dots \tau_i \dots \rvec}{\psi_{i}}{o_i}}
  {\TypeOf{\Gamma}{(ref_i \: \: e)}{ \tau_i}{\NOT{\Ftype}_{\mathbf{ref_i}(x)}[o / x]}{\mathbf{ref_i}(x) [o / x]}}


\and
  \inferrule[T-Subsume]
  {\TypeOf{\Gamma}{e}{\tau}{\psi}{o} \\\\
    \Proves{\Gamma, \psi}{\psi'} \\
    \tau <: \tau' \\ o <: o'}
  {\TypeOf{\Gamma}{e}{\tau'}{\psi'}{o'}}

\end{mathpar}
\caption{Typing Rules}
\end{figure}

% Subtyping Rules
\begin{figure}
\begin{mathpar}
  \inferrule[S-Refl]
  {}{\vdash \tau <: \tau}

\and
  \inferrule[S-Top]
  {}{\vdash \tau <: \top}

\and
  \inferrule[S-UnionSuper]
  {\exists \sigma \in \listof{\sigma}, \: \vdash \tau <: \sigma}
  {\vdash \tau <: (\U \listof{\sigma})}

\and
  \inferrule[S-UnionSub]
  {\forall \tau \in  \listof{\tau}, \vdash \tau <: \sigma}{\vdash (\U \listof{\tau}) <: \sigma}

\and
  \inferrule[S-Pair]
  {\vdash \sigma_1 <: \tau_1 \\\\
  \vdash \sigma_2 <: \tau_2}
  {\vdash \pairtype{\sigma_1}{\sigma_2} <: \pairtype{\tau_1}{\tau_2}}


\and
  \inferrule[S-Fun]
  {\vdash \sigma' <: \sigma \\ \vdash \tau <: \tau' \\\\
  \psi \vdash \psi' \\ \vdash o <: o' \\ }
  {\vdash \funtype{x}{\sigma}{\psi}{o}{\tau} 
    <: 
   \funtype{x}{\sigma'}{\psi'}{o'}{\tau'}}

\and
  \inferrule[S-Vec]
  {\forall i, \vdash \sigma_i <: \tau_i}
  {\vdash \lvec \sigma_o \dots \sigma_i \rvec 
    <: 
  \lvec \tau_o \dots \tau_i \rvec}


\and
  \inferrule[S-Ineq]
  {\textrm{unsatisfiable}(\Phi \Join \NOT{\Phi'})}
  {\vdash \deptype{\Phi} <: \deptype{\Phi'}}

\and
  \inferrule[S-IneqNum]
  {\vdash \Ntype <: \tau}
  {\vdash \deptype{\Phi} <: \tau}


\end{mathpar}
\caption{Subtyping Rules}
\end{figure}

% Logic Rules
\begin{figure}
\begin{mathpar}

  \inferrule[L-Atom]
  {\nu_{\pi(x)} \in \Gamma}
  {\Gamma \vdash \nu_{\pi(x)}}

\and
  \inferrule[L-True]
  {}
  {\Gamma \vdash \Tprop}

\and
  \inferrule[L-False]
  {\Gamma \vdash \Fprop}
  {\Gamma \vdash \psi}

\and
  \inferrule[L-AndI]
  {\Gamma \vdash \psi_1 \\\\
    \Gamma \vdash \psi_2}
  {\Gamma \vdash \psi_1 \wedge \psi_2}

\and
  \inferrule[L-AndE]
  {\Gamma, \psi_1, \psi_2 \vdash \psi}
  {\Gamma, \psi_1 \wedge \psi_2 \vdash \psi}

\and
  \inferrule[L-ImpI]
  {\Gamma, \psi_1 \vdash \psi_2}
  {\Gamma \vdash \psi_1 \supset \psi_2}

\and
  \inferrule[L-ImpE]
  {\Gamma \vdash \psi_1 \\\\
    \Gamma \vdash \psi_1 \supset \psi_2}
  {\Gamma \vdash \psi_2}

\and
  \inferrule[L-OrI]
  {\Gamma \vdash \psi_1 \: \: \textrm{or} \: \: \Gamma \vdash \psi_2}
  {\Gamma \vdash \psi_1 \vee \psi_2}

\and
  \inferrule[L-OrE]
  {\Gamma, \psi_1 \vdash \psi \\\\ 
    \Gamma, \psi_2 \vdash \psi}
  {\Gamma, \psi_1 \vee \psi_2 \vdash \psi}

\and
  \inferrule[L-Sub]
  {\Gamma \vdash \tau_x \\ \vdash \tau <: \sigma} 
  {\Gamma \vdash \sigma_x}

\and
  \inferrule[L-SubNot]
  {\Gamma \vdash \NOT{\sigma}_x \\ \vdash \tau <: \sigma} 
  {\Gamma \vdash \NOT{\tau}_x}

\and
  \inferrule[L-Bot]
  {\Gamma \vdash \bot_x} 
  {\Gamma \vdash \psi}

\and
  \inferrule[L-Update]
  {\Gamma \vdash \tau_x \\ \Gamma \vdash \nu_x}
  {\Gamma \vdash \textrm{update}(\tau, \nu)_x}

\and
  \inferrule[L-Ineq]
  {\Gamma \vdash \Ntype_x \\ \Gamma \vdash \Phi' \\\\ 
    \textrm{unsatisfiable}(\Phi' \Join (\Phi[x / \diamond]))}
  {\Gamma \vdash \deptype{\Phi}_x}

\and
  \inferrule[L-IneqSimple]
  {\Gamma, \Ntype_x, \Phi[x / \diamond] \vdash \psi}
  {\Gamma, \deptype{\Phi}_x \vdash \psi}

\and
  \inferrule[L-IneqJoin]
  {\Gamma, (\Phi_1 \Join \Phi_2) \vdash \psi}
  {\Gamma, \Phi_1, \Phi_2 \vdash \psi}
  
  \and
  \inferrule[L-IneqUnsat]
  {\Gamma \vdash \Phi \\\\
    \textrm{unsatisfiable}(\Phi)}
  {\Gamma \vdash \psi}

\end{mathpar}
\caption{Logic Rules}

\end{figure}


\begin{figure}
\begin{tabular}{r  c  l }

$ \neg \Tprop $ & $ = $ & $ \Fprop $ \\
$ \neg \Fprop $ & $ = $ & $ \Tprop $ \\
$ \neg \Uprop $ & $ = $ & $ \Uprop $ \\
$ \neg \tau_{\pi(x)}$ & $ = $ & $\NOT{\tau}_{\pi(x)} $ \\ 
$ \neg \NOT\tau_{\pi(x)}$ & $ = $ & ${\tau}_{\pi(x)} $ \\ 
$ \neg (P \vee Q) $ & $ = $ & $ \neg P \wedge \neg Q $ \\
$ \neg (P \wedge Q) $ & $ = $ & $ \neg P \vee \neg Q $ \\
$ \neg (P \supset Q) $ & $ = $ & $ \neg P \wedge Q $ 


\end{tabular}

\caption{Proposition Negation}

\end{figure}



\begin{figure}
\begin{tabular}{l  l  r}

$ \nu_{\pi(x)}[\pi'(y)/x] $ & $ = (\nu[\pi'(y)/x])_{\pi(\pi'(y))} $ & \\
$ \nu_{\pi(x)}[\NullO/x]^+ $ & $ = \Tprop $ & \\
$ \nu_{\pi(x)}[\NullO/x]^- $ & $ = \Fprop $ & \\
$ \nu_{\pi(x)}[o/z] $ & $ = \nu_{\pi(x)} $ & $ x \neq z $ and $ z \not\in \textrm{fv}(\nu) $ \\
$ \nu_{\pi(x)}[o/z]^+ $ & $ = \Tprop $ & $ x \neq z $ and $ z \in \textrm{fv}(\nu) $ \\
$ \nu_{\pi(x)}[o/z]^- $ & $ = \Fprop $ & $ x \neq z $ and $ z \in \textrm{fv}(\nu) $ \\
$ \Tprop [o/x] $ & $ = \Tprop $ & \\
$ \Fprop [o/x] $ & $ = \Fprop $ & \\
$ \Uprop [o/x] $ & $ = \Uprop $ & \\
$ (\psi_1 \supset \psi_2)[o/x]^+ $ & $ = \psi_1[o/x]^- \supset \psi_2[o/x]^+ $ & \\
$ (\psi_1 \supset \psi_2)[o/x]^- $ & $ = \psi_1[o/x]^+ \supset \psi_2[o/x]^- $ & \\
$ (\psi_1 \vee \psi_2)[o/x] $ & $ = \psi_1[o/x] \vee \psi_2[o/x] $ & \\
$ (\psi_1 \wedge \psi_2)[o/x] $ & $ = \psi_1[o/x] \wedge \psi_2[o/x] $ & \\
$ \Phi[o/x] $ & $ = \Phi $ & $ x \not\in \Phi $ \\
$ \Phi[\pi'(y)/x] $ & $ = \forall \phi \in \Phi,\: \phi[x \mapsto \pi'(y)] $ & $ x \in \Phi $ \\
$ \Phi[\NullO/x]^{\pm} $ & $ = \textrm{FMelim}(\Phi, \: x, \: \pm) $ & $ x \in \Phi $ \\
\\
$ \pi(x)[\pi'(y)/x]$ & $ =\pi(\pi(y)) $ & \\
$ \pi(x)[\NullO/x]$ & $ =\NullO $ & \\
$ \pi(x)[o/z]$ & $ =\pi(x) $ & $ x \neq z $ \\
$ \NullO[o/x]$ & $ =\NullO $ & 


\end{tabular}

\caption{Substitution}

\end{figure}



\end{document}
