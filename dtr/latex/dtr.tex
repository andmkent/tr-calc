\documentclass{article}
\usepackage{xspace}
\usepackage{amssymb}
\usepackage{amsmath}
\usepackage{amsfonts}
\usepackage{amsthm}
%\usepackage{mathabx}
\usepackage{mathpartir}
\usepackage[margin=0.5in]{geometry}

\usepackage{bbm}
\makeatletter
\newcommand{\ctx}{\ensuremath{\mathsf{ctx}}}
\newcommand{\define}[1]{\textbf{#1}}
\newcommand{\indexdef}[1]{\index{#1|defstyle}}   
\newcommand{\indexsee}[2]{\index{#1|see{#2}}}    
\newcommand{\intro}{\textsc{intro}}
\def\lamu#1{{\lambda}\@lamuarg#1:\@endlamuarg\@ifnextchar\bgroup{.\,\lamu}{.\,}}
\def\@lamuarg#1:#2\@endlamuarg{#1}
\newcommand{\Subst}{\mathsf{Subst}}
\newcommand{\tmtp}[2]{#1 \mathord{:} #2}
\def\tprd#1{\@tprd{#1}\@ifnextchar\bgroup{\tprd}{}}
\def\@tprd#1{\mathchoice{{\textstyle\prod_{(#1)}}}{\prod_{(#1)}}{\prod_{(#1)}}{\prod_{(#1)}}}
\newcommand{\UU}{\ensuremath{\mathcal{U}}\xspace}
\newcommand{\Vble}{\mathsf{Vble}}
\newcommand{\Weak}{\mathsf{Wkg}}
\newcommand{\wfctx}[1]{#1\ \ctx}
\makeatother

\newcommand{\Ttype}{\mathbf{T}}
\newcommand{\Ftype}{\mathbf{F}}
\newcommand{\Tval}{\# \textrm{t}}
\newcommand{\Fval}{\# \textrm{f}}
\newcommand{\Tprop}{\mathbb{T}}
\newcommand{\Fprop}{\mathbb{F}}
\newcommand{\Uprop}{\mathbb{U}}
\newcommand{\Ntype}{\mathbf{N}}
\newcommand{\Btype}{\mathbf{B}}
\newcommand{\NOT}[1]{\overline{#1}}
\newcommand{\TypeOf}[5]{#1 \vdash #2 : #3 \: ; \: #4 \: ; \: #5}
\newcommand{\Proves}[2]{#1 \vdash #2}
\newcommand{\listof}{\overrightarrow}
\newcommand{\lvec}{[[}
\newcommand{\rvec}{]]}
\newcommand{\vectype}[1]{\lvec #1 \rvec}
\newcommand{\funtype}[5]{#1\mathord{:}#2 \xrightarrow[ #4 ]{ #3 } #5 }
\newcommand{\deptype}[3]{\{ #1 : #2 \: | \: #3 \}}
\newcommand{\pairtype}[2]{\langle #1 , #2 \rangle}
\newcommand{\U}{\bigcup}
\newcommand{\NullO}{\emptyset}
\newcommand{\update}[3]{\textrm{update}(#1, #2, #3)}
\newcommand{\carpe}{\mathbf{car}}
\newcommand{\cdrpe}{\mathbf{cdr}}
% \newcommand{\refpe}[1]{\mathbf{ref}_{#1}}
\newcommand{\lenpe}{\mathbf{len}}
\newcommand{\lexp}{\mathfrak{L}}

\begin{document}
\index{structural!rules|(}%
\index{rule!structural|(}%

\begin{figure}
\begin{tabular}{r  l  l}

$e  ::= $ & 
  $ x \mid 
  (e \: e) \mid  
  \lambda x^{\tau}.e \mid 
  (\mathbf{if} \: e \: e \: e) \mid
  c \mid
  \Tval \mid
  \Fval \mid
  (cons \: e \: e) \mid
  (vec \: \listof{e}) \mid
  n $ & Expressions \\
$c  ::= $ & $ 
	+ \mid 
    * \mid
	\: \leq \: \mid  
	num? \mid 
	 bool? \mid
	 proc? \mid
	 cons? \mid
	 vec? \mid
	 car \mid
	 cdr \mid
	 len \mid
     ref $ & Primitive Operations \\
$ pe ::= $ & $ 
	\carpe \mid 
	\cdrpe \mid
%	\refpe{\lexp} \mid
	\lenpe $ & Path Elements \\
$ \pi ::= $ & $ 
	\listof{pe} $ & Paths \\
$ \lexp ::= $ & $ 
	n \mid
    \pi(x) \mid
    n \lexp \mid
    \lexp + \lexp $ & Linear Expressions \\
$ o ::= $ & $ 
	\NullO \mid 
    \pi (x) \mid
    \lexp $ & Objects \\
$ \phi ::= $ & $ 
	\lexp \leq \lexp $ & Linear Inequalities \\
$ \Phi ::= $ & $ 
	\listof{\phi} $ & System of Linear Inequalities \\
$\sigma , \tau  ::= $ & $ 
	\top \mid
    \Ntype \mid 
	\deptype{x}{\tau}{\psi} \mid
	\Ttype \mid
	\Ftype  \mid
	(\U \listof{\tau}) \mid
	\pairtype{\tau}{\tau} \mid
	\vectype{\tau} \mid
	\funtype{x}{\sigma}{\psi}{o}{\tau} $ & Types \\
$\psi ::= $ & $ 
	\tau_{\pi(x)} \mid 
	\NOT{\tau}_{\pi(x)} \mid 
	\psi \supset \psi \mid 
	\psi \wedge \psi \mid 
	\psi \vee \psi \mid 
    \Phi \mid 
	\Tprop \mid 
	\Fprop \mid 
    \Uprop $ & Propositions \\
$ \Gamma ::= $ & $ 
	\listof{\psi} $ & Environments \\	
\end{tabular}
\\
\\
$ \bot $ is defined as $(\U)$, $\Btype$ is defined as $(\U \: \Ttype \: \: \Ftype)$.
\caption{Syntax of Types, Propositions, Terms, etc...}
\end{figure}


% Typing Rules
\begin{figure}
\begin{mathpar}

  \inferrule[T-Num]
  {}{\TypeOf{\Gamma}{n}{\deptype{x}{\Ntype}{x = n}}{\Tprop}{n}}

\and
  \inferrule[T-Const]
  {}{\TypeOf{\Gamma}{c}{\delta_{\tau}(c)}{\Tprop}{\NullO}}

\and
  \inferrule[T-True]
  {}{\TypeOf{\Gamma}{\Tval}{\Ttype}{\Tprop}{\NullO}}

\and
  \inferrule[T-False]
  {}{\TypeOf{\Gamma}{\Fval}{\Ftype}{\Fprop}{\NullO}}

\and
  \inferrule[T-Var]
  {\Proves{\Gamma}{\tau_{x}}}
  {\TypeOf{\Gamma}{x}{\tau}{\NOT{\Ftype}_x}{x}}

\and
  \inferrule[T-Abs]
  {\TypeOf{\Gamma, \sigma_x}{e}{\tau}{\psi}{o}}
  {\TypeOf{\Gamma}{\lambda x^\sigma . e}{\funtype{x}{\sigma}{\psi}{o}{\tau}}{\Tprop}{\NullO}}


\and
  \inferrule[T-App]
  {\TypeOf{\Gamma}{e}{\funtype{x}{\sigma}{\psi_{f}}{o_f}{\tau}}{\psi}{o} \\\\
    \TypeOf{\Gamma}{e'}{\sigma}{\psi'}{o'}}
  {\TypeOf{\Gamma} {(e \: e')}{\tau [o' / x]}{\psi_{f} [o' / x]}{o_f[o' / x]}}


\and
  \inferrule[T-If]
  {\TypeOf{\Gamma}{e_1}{\tau_1}{\psi_{1}}{o_1} \\\\
    \TypeOf{\Gamma}{e_2}{\tau}{\psi}{o} \\\\
    \TypeOf{\Gamma}{e_3}{\tau}{\psi}{o}}
  {\TypeOf{\Gamma}{(\mathbf{if} \: e_1 \: e_2 \: e_3)}{ \tau}{\psi}{o}}

\and
  \inferrule[T-Let]
  {\TypeOf{\Gamma}{e_0}{\tau}{\psi_{0}}{o_0} \\\\
    \TypeOf{\Gamma, \tau_x, \NOT{\Ftype}_x \supset \psi_{0}, \Ftype_x \supset \neg\psi_{0}}{e_1}{\sigma}{\psi_{1}}{o_1}}
  {\TypeOf{\Gamma}{(\mathbf{let} \: (x \: e_0) \: e_1)}{\sigma [o_0 / x]}{\psi_{1} [o_0 / x]} {o_1 [o_0 / x]}}


\and
  \inferrule[T-Cons]
  {\TypeOf{\Gamma}{e_1}{\tau_1}{\psi_{1}}{o_1} \\\\
    \TypeOf{\Gamma}{e_2}{\tau_2}{\psi_{2}}{o_2}}
  {\TypeOf{\Gamma}{(cons \: e_1 \: e_2)}{\pairtype{\tau_1}{\tau_2}}{\Tprop}{\NullO}}

\and
  \inferrule[T-Car]
  {\TypeOf{\Gamma}{e}{\pairtype{\tau_1}{\tau_2}}{\psi}{o} \\\\
  \psi_{r} = \NOT{\Ftype}_{\mathbf{car}(x)} [o / x]}
  {\TypeOf{\Gamma}{(car \: e)}{\tau_1}{\psi_{r}}{\mathbf{car}(x) [o / x]}}

\and
  \inferrule[T-Cdr]
  {\TypeOf{\Gamma}{e}{\pairtype{\tau_1}{\tau_2}}{\psi}{o} \\\\
  \psi_{r} = \NOT{\Ftype}_{\mathbf{cdr}(x)} [o / x]}
  {\TypeOf{\Gamma}{(cdr \: e)}{\tau_2}{\psi_{r}}{\mathbf{cdr}(x) [o / x]}}

\and
  \inferrule[T-Vec]
  {\TypeOf{\Gamma}{e_1}{\tau}{\psi_{1}}{o_1} \\\\
    \dots \\\\
    \TypeOf{\Gamma}{e_n}{\tau}{\psi_{n}}{o_n}}
  {\TypeOf{\Gamma}{(vec \: e_1 \: \dots \: e_n)}{\vectype{\tau}}{\Tprop}{\NullO}}

\and
  \inferrule[T-Ref]
  {\TypeOf{\Gamma}{e_1}{\vectype{\tau}}{\psi_1}{o_1} \\\\
    \TypeOf{\Gamma}{e_2}{\deptype{x}{\Ntype}{0 \leq x \leq \lenpe(o_1)}}{\psi_2}{o_2}}
%  o_r = \textrm{refobject}(\refpe{x}[o_2 / x], o_1)}
  {\TypeOf{\Gamma}{(ref \: e_1 \: e_2)}{\tau}{\textrm{prop}(\tau)}{\NullO}}


\and
  \inferrule[T-Subsume]
  {\TypeOf{\Gamma}{e}{\tau}{\psi}{o} \\\\
    \Proves{\Gamma}{\psi <: \psi'} \\
    \vdash \tau <: \tau' \\ \vdash o <: o'}
  {\TypeOf{\Gamma}{e}{\tau'}{\psi'}{o'}}

\end{mathpar}
\caption{Typing Rules}
\end{figure}

% Subtyping Rules
\begin{figure}
\begin{mathpar}

  \inferrule[SP-Impl]
  {\Gamma, \psi \vdash \psi'}
  {\Gamma \vdash \psi <: \psi'}

\and
  \inferrule[SP-Refl]
  {}{\Gamma \vdash \psi <: \psi}

\and
  \inferrule[SP-Top]
  {}{\Gamma \vdash \psi <: \Uprop}


\and
  \inferrule[SO-Refl]
  {}{\vdash o <: o}

\and
  \inferrule[SO-Top]
  {}{\vdash o <: \NullO}

\and
  \inferrule[S-Refl]
  {}{\vdash \tau <: \tau}

\and
  \inferrule[S-Top]
  {}{\vdash \tau <: \top}

\and
  \inferrule[S-UnionSuper]
  {\exists \sigma \in \listof{\sigma}, \: \vdash \tau <: \sigma}
  {\vdash \tau <: (\U \listof{\sigma})}

\and
  \inferrule[S-UnionSub]
  {\forall \tau \in  \listof{\tau}, \vdash \tau <: \sigma}{\vdash (\U \listof{\tau}) <: \sigma}

\and
  \inferrule[S-Pair]
  {\vdash \sigma_1 <: \tau_1 \\\\
  \vdash \sigma_2 <: \tau_2}
  {\vdash \pairtype{\sigma_1}{\sigma_2} <: \pairtype{\tau_1}{\tau_2}}


\and
  \inferrule[S-Fun]
  {\vdash \sigma' <: \sigma \\ \vdash \tau <: \tau' \\\\
  \vdash \psi <: \psi' \\  \vdash o <: o' \\ }
  {\vdash \funtype{x}{\sigma}{\psi}{o}{\tau} 
    <: 
   \funtype{x}{\sigma'}{\psi'}{o'}{\tau'}}

\and
  \inferrule[S-Vec]
  {\vdash \sigma <: \tau}
  {\vdash \vectype{\sigma} <: \vectype{\tau}}


\and
  \inferrule[S-Dep]
  {\vdash \tau <: \sigma \\ \psi \vdash \psi'}
  {\vdash \deptype{x}{\tau}{\psi} <: \deptype{x}{\sigma}{\psi'}}

\and
  \inferrule[S-DepWeak]
  {\vdash \tau <: \sigma}
  {\vdash \deptype{x}{\tau}{\psi} <: \sigma}


\end{mathpar}
\caption{Subtyping Rules}
\end{figure}

% Logic Rules
\begin{figure}
\begin{mathpar}

  \inferrule[L-Atom]
  {\chi \in \Gamma}
  {\Gamma \vdash \chi}

\and
  \inferrule[L-True]
  {}
  {\Gamma \vdash \Tprop}

\and
  \inferrule[L-False]
  {\Gamma \vdash \Fprop}
  {\Gamma \vdash \psi}

\and
  \inferrule[L-AndI]
  {\Gamma \vdash \psi_1 \\\\
    \Gamma \vdash \psi_2}
  {\Gamma \vdash \psi_1 \wedge \psi_2}

\and
  \inferrule[L-AndE]
  {\Gamma, \psi_1, \psi_2 \vdash \psi}
  {\Gamma, \psi_1 \wedge \psi_2 \vdash \psi}

\and
  \inferrule[L-ImpI]
  {\Gamma, \psi_1 \vdash \psi_2}
  {\Gamma \vdash \psi_1 \supset \psi_2}

\and
  \inferrule[L-ImpE]
  {\Gamma \vdash \psi_1 \\\\
    \Gamma \vdash \psi_1 \supset \psi_2}
  {\Gamma \vdash \psi_2}

\and
  \inferrule[L-OrI]
  {\Gamma \vdash \psi_1 \: \: \textrm{or} \: \: \Gamma \vdash \psi_2}
  {\Gamma \vdash \psi_1 \vee \psi_2}

\and
  \inferrule[L-OrE]
  {\Gamma, \psi_1 \vdash \psi \\\\ 
    \Gamma, \psi_2 \vdash \psi}
  {\Gamma, \psi_1 \vee \psi_2 \vdash \psi}

\and
  \inferrule[L-Sub]
  {\Gamma \vdash \tau_{\pi(x)} \\ \vdash \tau <: \sigma} 
  {\Gamma \vdash \sigma_{\pi(x)}}

\and
  \inferrule[L-SubNot]
  {\Gamma \vdash \NOT{\sigma}_{\pi(x)} \\ \vdash \tau <: \sigma} 
  {\Gamma \vdash \NOT{\tau}_{\pi(x)}}

\and
  \inferrule[L-Bot]
  {\Gamma \vdash \bot_{\pi(x)}} 
  {\Gamma \vdash \psi}

\and
  \inferrule[L-Update]
  {\Gamma \vdash \tau_{\pi'(x)} \\ \Gamma \vdash \nu_{\pi(\pi'(x))}}
  {\Gamma \vdash \update{\tau}{\nu}{\pi}_{\pi'(x)}}

\and
  \inferrule[L-IneqImpl]
  {\Proves{\Gamma}{\Phi_1} \\\\ 
  \textrm{unsatisfiable}(\Phi_1 \Join \NOT{\Phi}_2)}
  {\Proves{\Gamma}{\Phi_2}}

\and
  \inferrule[L-IneqJoin]
  {\Gamma, (\Phi_1 \Join \Phi_2) \vdash \psi}
  {\Gamma, \Phi_1, \Phi_2 \vdash \psi}
  
  \and
  \inferrule[L-IneqUnsat]
  {\Gamma \vdash \Phi \\\\
    \textrm{unsatisfiable}(\Phi)}
  {\Gamma \vdash \psi}

\end{mathpar}
Where $ \chi $ ranges over propositions of the form $ \tau_{\pi(x)} $,
$ \NOT{\tau}_{\pi(x)} $, and $ \Phi $.
\caption{Logic Rules}

\end{figure}

\begin{figure}
\begin{tabular}{l  l  r}

$ \psi_1 \mid \psi_2 [o / x] $ & $ = \psi_1 [o / x] \mid \psi_2 [o / x] $ & \\
\\
$ \nu_{\pi(x)}[\pi'(y)/x] $ & $ = (\nu[\pi'(y)/x])_{\pi(\pi'(y))} $ & \\
$ \nu_{\pi(x)}[\NullO/x]^+ $ & $ = \Tprop $ & \\
$ \nu_{\pi(x)}[\NullO/x]^- $ & $ = \Fprop $ & \\
$ \nu_{\pi(x)}[o/z] $ & $ = \nu_{\pi(x)} $ & $ x \neq z $ and $ z \not\in \textrm{fv}(\nu) $ \\
$ \nu_{\pi(x)}[o/z]^+ $ & $ = \Tprop $ & $ x \neq z $ and $ z \in \textrm{fv}(\nu) $ \\
$ \nu_{\pi(x)}[o/z]^- $ & $ = \Fprop $ & $ x \neq z $ and $ z \in \textrm{fv}(\nu) $ \\
$ \Tprop[o/x] $ & $ = \Tprop $ & \\
$ \Fprop[o/x] $ & $ = \Fprop $ & \\
$ (\psi_1 \supset \psi_2)[o/x]^+ $ & $ = \psi_1[o/x]^- \supset \psi_2[o/x]^+ $ & \\
$ (\psi_1 \supset \psi_2)[o/x]^- $ & $ = \psi_1[o/x]^+ \supset \psi_2[o/x]^- $ & \\
$ (\psi_1 \vee \psi_2)[o/x] $ & $ = \psi_1[o/x] \vee \psi_2[o/x] $ & \\
$ (\psi_1 \wedge \psi_2)[o/x] $ & $ = \psi_1[o/x] \wedge \psi_2[o/x] $ & \\
$ \Phi[o/x] $ & $ = \Phi $ & $ x \not\in \Phi $ \\
$ \Phi[\pi'(y)/x] $ & $ = \forall \phi \in \Phi,\: \phi[x \mapsto \pi'(y)] $ & $ x \in \Phi $ \\
$ \Phi[\NullO/x]^{\pm} $ & $ = \textrm{FMelim}(\Phi, \: x, \: \pm) $ & $ x \in \Phi $ \\
\\
$ \pi(x)[\pi'(y)/x]$ & $ =\pi[\pi'(y)/x](\pi'(y)) $ & \\
$ \pi(x)[\NullO/x]$ & $ =\NullO $ & \\
$ \pi(x)[o/z]$ & $ =\pi[o/z](x) $ & $ x \neq z $ \\
$ \NullO[o/x]$ & $ =\NullO $ & 

\end{tabular}

\caption{Substitution}

\end{figure}

\begin{figure}
  \begin{tabular}{l l r}
    $ \update{\pairtype{ \tau }{ \sigma }}{\nu}{\pi :: \mathbf{car}} $ 
      & $ = \pairtype{\update{\tau}{\nu}{\pi}}{\sigma} $ & \\
    $ \update{\pairtype{ \tau }{ \sigma }}{\nu}{\pi :: \mathbf{cdr}} $ 
      & $ = \pairtype{\tau}{\update{\sigma}{\nu}{\pi}} $ & \\
    
  \end{tabular}
\end{figure}


\end{document}
